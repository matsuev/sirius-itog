# Итоговая проверочная работа

---

#### Демонстрационное задание

* Все исполняемые файлы расположены в папке ./bin
* Файлы Frontend-приложения расположены в папке ./frontend

---

!!! __ВАЖНОЕ ЗАМЕЧАНИЕ:__
В выражение **map** конфигурации NGINX необходимо добавить опцию **hostnames;**

Пример:
```
map $http_x_rpc_method $target_service {
   hostnames;

   user.*  user-service;
   default core-service;
}
```
---
1. В Docker Compose нужно сконфигурировать следующую инфраструктуру:
   * __loadbalancer__ - роутер/балансировщик нагрузки
   * __core-service__ - контейнер с запущенным сервисом __./bin/core-service__
   * __math-service__ - контейнер с запущенным сервисом __./bin/math-service__

2. loadbalancer должен отвечать на запросы по адресу http://127.0.0.1:8080 (внутри контейнера сервис использует порт __:80__)

3. Сервисы __core-service__ и __math-service__ должны быть доступны только внутри Compose и принимать подключения на порту __:80__

4. Запрос по адресу __http://127.0.0.1:8080__ должен возвращать стартовую страницу frontend приложения. Файлы веб приложения расположены в папке __./frontend__. Необходимо смонтировать эту папку в контейнер и настроить правило маршрутизации для __location /__

5. Запросы по адресу __http://127.0.0.1:8080/rpc__ должны возвращать результаты вызовов к микросервисам __core-service__ и __math-service__

6. Правила RPC протокола:
   * Максимальный размер пакета - 64 байт
   * Время выполнения запроса - 1 секунда
   * Запросы только методом POST (ошибка: 405)
   * В запросе должны присутствовать следующие заголовки:
     * X-Client-ID: sirius-frontend (ошибка: 401)
     * X-Client-Secret: <любая строка> (ошибка: 401)
     * X-Rpc-Method: <math.*> (ошибка: 400)
   * Тело запроса должно приходить в формате JSON (ошибка: 400)

7. Правила маршрутизации запросов для __location /rpc__
   * Все запросы удовлетворяющие правилу __math.*__ проксируются в сервис __math-service__
   * Все остальные запросы просируются в __core-service__

8. Правила RPC запросов: __math-service__ выполняет следующие функции:

* math.sum - сложение
* math.sub - вычитание
* math.mult - умножение
* math.div - целочисленное деление

В теле запроса необходимо отправить данные в формате JSON:
```
{
   "a": 20,
   "b": 10
}
```
Ответ сервера на запрос с заголовком X-Rpc-Method: math.sum
```
{
   "result": 30
}
```
